<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puan Durumu - Tribe League</title>
    <meta name="description" content="Tribe League puan durumu tablosu">
    <link
        href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600;700&family=Outfit:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        :root {
            --bg-body: #0a0a0e;
            --bg-card: #141419;
            --primary: #c4ff0e;
            --primary-glow: rgba(196, 255, 14, 0.4);
            --text-main: #ffffff;
            --text-muted: #8b8b96;
            --border: rgba(255, 255, 255, 0.08);
            --font-head: 'Teko', sans-serif;
            --font-body: 'Outfit', sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: var(--bg-body);
            color: var(--text-main);
            font-family: var(--font-body);
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        .special-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            max-width: 1100px;
            margin: 30px auto;
        }

        .header-banner {
            text-align: center;
            background: linear-gradient(135deg, #222 0%, #111 100%);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .header-banner h1 {
            font-family: var(--font-head);
            font-size: 3.5rem;
            color: var(--primary);
            margin: 0;
            line-height: 1;
        }

        .firebase-badge {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: #fff;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            display: inline-block;
            margin-top: 10px;
        }

        .standings-table {
            width: 100%;
            border-collapse: collapse;
        }

        .standings-table th {
            background: rgba(255, 255, 255, 0.05);
            color: var(--primary);
            font-family: var(--font-head);
            font-size: 1.2rem;
            padding: 15px 10px;
            text-align: center;
            border-bottom: 2px solid var(--border);
        }

        .standings-table th:nth-child(2) {
            text-align: left;
        }

        .standings-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .standings-table td:nth-child(2) {
            text-align: left;
        }

        .standings-table tbody tr:hover {
            background: rgba(196, 255, 14, 0.05);
        }

        /* Animasyonlu S�ralama */
        .standings-table tbody tr {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideIn 0.4s ease forwards;
            opacity: 0;
            transform: translateX(-20px);
        }

        @keyframes slideIn {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .standings-table tbody tr:nth-child(1) {
            animation-delay: 0.05s;
        }

        .standings-table tbody tr:nth-child(2) {
            animation-delay: 0.1s;
        }

        .standings-table tbody tr:nth-child(3) {
            animation-delay: 0.15s;
        }

        .standings-table tbody tr:nth-child(4) {
            animation-delay: 0.2s;
        }

        .standings-table tbody tr:nth-child(5) {
            animation-delay: 0.25s;
        }

        .standings-table tbody tr:nth-child(6) {
            animation-delay: 0.3s;
        }

        .standings-table tbody tr:nth-child(7) {
            animation-delay: 0.35s;
        }

        .standings-table tbody tr:nth-child(8) {
            animation-delay: 0.4s;
        }

        .standings-table tbody tr:nth-child(9) {
            animation-delay: 0.45s;
        }

        .standings-table tbody tr:nth-child(10) {
            animation-delay: 0.5s;
        }

        .standings-table tbody tr:nth-child(11) {
            animation-delay: 0.55s;
        }

        .standings-table tbody tr:nth-child(12) {
            animation-delay: 0.6s;
        }

        .standings-table tbody tr:nth-child(13) {
            animation-delay: 0.65s;
        }

        .standings-table tbody tr:nth-child(14) {
            animation-delay: 0.7s;
        }

        .rank-up {
            background: linear-gradient(90deg, rgba(46, 213, 115, 0.2), transparent) !important;
        }

        .rank-down {
            background: linear-gradient(90deg, rgba(255, 71, 87, 0.2), transparent) !important;
        }

        .rank-cell {
            font-family: var(--font-head);
            font-size: 1.3rem;
            font-weight: 700;
            width: 40px;
        }

        .rank-1 {
            color: #ffd700;
        }

        .rank-2 {
            color: #c0c0c0;
        }

        .rank-3 {
            color: #cd7f32;
        }

        .team-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .team-logo-sm {
            width: 32px;
            height: 32px;
            object-fit: contain;
        }

        .team-name-cell {
            font-weight: 600;
        }

        .points-box {
            background: var(--primary);
            color: #000;
            font-family: var(--font-head);
            font-size: 1.3rem;
            font-weight: 700;
            padding: 5px 12px;
            border-radius: 8px;
            display: inline-block;
            min-width: 40px;
        }

        .form-container {
            display: flex;
            gap: 3px;
            justify-content: center;
        }

        .form-box {
            width: 22px;
            height: 22px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            color: #fff;
        }

        .form-G {
            background: #28a745;
        }

        .form-B {
            background: #ffc107;
            color: #000;
        }

        .form-M {
            background: #dc3545;
        }

        .av-positive {
            color: #28a745;
        }

        .av-negative {
            color: #dc3545;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {

            .standings-table th,
            .standings-table td {
                padding: 8px 5px;
                font-size: 0.85rem;
            }

            .team-logo-sm {
                width: 24px;
                height: 24px;
            }

            .form-box {
                width: 18px;
                height: 18px;
                font-size: 9px;
            }
        }

        /* ŞAMPİYON ANİMASYONU */
        .champion-overlay {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #000000ee, #1a1a1aee);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: championFadeIn 0.5s ease-out;
        }

        .champion-overlay.hiding {
            animation: championFadeOut 0.8s ease-in forwards;
        }

        @keyframes championFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes championFadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        .champion-trophy {
            font-size: 6rem;
            color: #ffd700;
            animation: trophyBounce 1s ease infinite, trophyGlow 1.5s ease-in-out infinite;
            text-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
        }

        @keyframes trophyBounce {

            0%,
            100% {
                transform: translateY(0) scale(1);
            }

            50% {
                transform: translateY(-20px) scale(1.1);
            }
        }

        @keyframes trophyGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 30px #ffd700);
            }

            50% {
                filter: drop-shadow(0 0 60px #ffed4a);
            }
        }

        .champion-text {
            font-family: var(--font-head);
            font-size: 4rem;
            color: #ffd700;
            text-transform: uppercase;
            letter-spacing: 10px;
            margin-top: 20px;
            animation: textPulse 0.8s ease-in-out infinite alternate;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }

        .champion-team {
            font-family: var(--font-head);
            font-size: 6rem;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 15px;
            margin-top: 10px;
            animation: teamZoom 1.2s ease-out forwards;
            text-shadow: 0 5px 30px rgba(0, 0, 0, 0.5), 0 0 50px rgba(255, 255, 255, 0.3);
        }

        @keyframes textPulse {
            from {
                transform: scale(1);
                opacity: 0.8;
            }

            to {
                transform: scale(1.05);
                opacity: 1;
            }
        }

        @keyframes teamZoom {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .champion-stars {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .star {
            position: absolute;
            color: #ffd700;
            animation: starFall linear infinite;
            opacity: 0.8;
        }

        @keyframes starFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .champion-logo {
            width: 150px;
            height: 150px;
            object-fit: contain;
            margin-top: 30px;
            animation: logoSpin 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.6));
        }

        @keyframes logoSpin {

            0%,
            100% {
                transform: rotateY(0deg);
            }

            50% {
                transform: rotateY(180deg);
            }
        }

        .skip-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 10px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-family: var(--font-body);
            transition: all 0.3s;
        }

        .skip-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .champion-text {
                font-size: 2rem;
                letter-spacing: 5px;
            }

            .champion-team {
                font-size: 3rem;
                letter-spacing: 8px;
            }

            .champion-trophy {
                font-size: 4rem;
            }

            .champion-logo {
                width: 100px;
                height: 100px;
            }
        }
    </style>
</head>

<body>
    <!-- ŞAMPİYON OVERLAY -->
    <div class="champion-overlay" id="championOverlay">
        <div class="champion-stars" id="championStars"></div>
        <i class="fas fa-trophy champion-trophy"></i>
        <div class="champion-text">ŞAMPİYON</div>
        <div class="champion-team">BEŞİKTAŞ</div>
        <img class="champion-logo"
            src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Logo_of_Be%C5%9Fikta%C5%9F_JK.svg/1200px-Logo_of_Be%C5%9Fikta%C5%9F_JK.svg.png"
            alt="Beşiktaş">
        <button class="skip-btn" onclick="closeChampionOverlay()"><i class="fas fa-forward"></i> Geç</button>
    </div>

    <div class="special-container">
        <div class="header-banner">
            <h1><i class="fas fa-trophy"></i> PUAN DURUMU</h1>
        </div>

        <table class="standings-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>TAKIM</th>
                    <th>O</th>
                    <th>G</th>
                    <th>B</th>
                    <th>M</th>
                    <th>A</th>
                    <th>Y</th>
                    <th>AV</th>
                    <th>P</th>
                    <th>FORM</th>
                </tr>
            </thead>
            <tbody id="standingsBody">
                <tr>
                    <td colspan="11" class="loading"><i class="fas fa-spinner fa-spin"></i> Y�kleniyor...</td>
                </tr>
            </tbody>
        </table>

        <!-- Şampiyonluk Oranları -->
        <div id="championshipOdds"
            style="margin-top: 30px; background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(196,255,14,0.05)); border: 1px solid rgba(255,215,0,0.3); border-radius: 16px; padding: 25px;">
            <h3
                style="font-family: var(--font-head); font-size: 1.8rem; color: #ffd700; margin: 0 0 20px; display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-chart-pie"></i> ŞAMPİYONLUK ORANLARI
            </h3>
            <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 20px;">Kalan maçlara göre hesaplanan
                tahmini şampiyonluk olasılıkları</p>
            <div id="oddsContainer" style="display: grid; gap: 12px;">
                <!-- JS tarafından doldurulacak -->
            </div>
        </div>
    </div>

    <script src="../data.js"></script>
    <script src="../firebase-config.js"></script>

    <script>
        let tribeData = null;

        function getLogoUrl(teamName) {
            return tribeData?.teams?.[teamName]?.logo || TribeData?.teams?.[teamName]?.logo || "https://via.placeholder.com/32?text=?";
        }

        function calculateStandings(matches, teams) {
            const standings = {};

            // T�m tak�mlar� ba�lat
            Object.keys(teams).forEach(name => {
                standings[name] = {
                    name, played: 0, won: 0, draw: 0, lost: 0, gf: 0, ga: 0, points: 0, form: []
                };
            });

            // Ma�lar� i�le
            matches.forEach(m => {
                const home = standings[m.home];
                const away = standings[m.away];
                if (!home || !away) return;

                home.played++;
                away.played++;
                home.gf += m.homeScore;
                home.ga += m.awayScore;
                away.gf += m.awayScore;
                away.ga += m.homeScore;

                if (m.homeScore > m.awayScore) {
                    home.won++; home.points += 3; home.form.push('G');
                    away.lost++; away.form.push('M');
                } else if (m.homeScore < m.awayScore) {
                    away.won++; away.points += 3; away.form.push('G');
                    home.lost++; home.form.push('M');
                } else {
                    home.draw++; away.draw++;
                    home.points++; away.points++;
                    home.form.push('B'); away.form.push('B');
                }
            });

            return Object.values(standings)
                .filter(t => t.played > 0)
                .sort((a, b) => {
                    if (b.points !== a.points) return b.points - a.points;
                    const gdA = a.gf - a.ga, gdB = b.gf - b.ga;
                    if (gdB !== gdA) return gdB - gdA;
                    return b.gf - a.gf;
                });
        }

        function renderStandings(data) {
            const matches = data?.matches || [];
            const teams = data?.teams || {};
            const standings = calculateStandings(matches, teams);
            const tbody = document.getElementById('standingsBody');

            if (standings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" style="color: var(--text-muted); text-align: center; padding: 40px;">Hen�z ma� verisi yok</td></tr>';
                return;
            }

            let html = '';
            standings.forEach((team, index) => {
                const rank = index + 1;
                const gd = team.gf - team.ga;
                const gdClass = gd > 0 ? 'av-positive' : (gd < 0 ? 'av-negative' : '');
                const gdDisplay = gd > 0 ? `+${gd}` : gd;
                const formHtml = team.form.slice(-5).map(f => `<span class="form-box form-${f}">${f}</span>`).join('');

                let rankClass = '';
                if (rank === 1) rankClass = 'rank-1';
                else if (rank === 2) rankClass = 'rank-2';
                else if (rank === 3) rankClass = 'rank-3';

                html += `
                    <tr>
                        <td class="rank-cell ${rankClass}">${rank}</td>
                        <td>
                            <div class="team-cell">
                                <img class="team-logo-sm" src="${getLogoUrl(team.name)}" alt="${team.name}">
                                <span class="team-name-cell">${team.name}</span>
                            </div>
                        </td>
                        <td>${team.played}</td>
                        <td>${team.won}</td>
                        <td>${team.draw}</td>
                        <td>${team.lost}</td>
                        <td>${team.gf}</td>
                        <td>${team.ga}</td>
                        <td class="${gdClass}">${gdDisplay}</td>
                        <td><span class="points-box">${team.points}</span></td>
                        <td><div class="form-container">${formHtml || '-'}</div></td>
                    </tr>
                `;
            });

            tbody.innerHTML = html;

            // Şampiyonluk oranlarını hesapla ve göster
            renderChampionshipOdds(standings, data);
        }

        function renderChampionshipOdds(standings, data) {
            const container = document.getElementById('oddsContainer');
            if (!container || standings.length < 2) {
                if (container) container.innerHTML = '<p style="color: var(--text-muted);">Yeterli veri yok</p>';
                return;
            }

            // Kalan maç sayısı hesapla (14 takım ligi varsayımı: 26 maç)
            const totalMatches = 26;
            const playedMatches = data?.matches?.length || 0;
            const remainingRounds = Math.max(0, totalMatches - (standings[0]?.played || 0));
            const maxPossiblePoints = remainingRounds * 3;

            // Her takım için şampiyonluk olasılığı hesapla
            const leader = standings[0];
            const leaderMaxPoints = leader.points + maxPossiblePoints;

            const oddsData = standings.slice(0, 6).map((team, index) => {
                const teamMaxPoints = team.points + maxPossiblePoints;
                const pointDiff = leader.points - team.points;

                // Basit olasılık modeli
                let probability = 0;

                if (index === 0) {
                    // Lider için başlangıç avantajı
                    probability = Math.min(95, 50 + (pointDiff === 0 ? 30 : 0) + (team.gf - team.ga) * 0.5);
                } else if (teamMaxPoints >= leader.points) {
                    // Matematiksel şansı var
                    probability = Math.max(1, 40 - (pointDiff * 5) + (team.won * 2) - (team.lost * 2));
                } else {
                    // Matematiksel şansı yok
                    probability = 0;
                }

                // Normalize et
                probability = Math.max(0, Math.min(100, probability));

                return { ...team, probability, canWin: teamMaxPoints >= leader.points };
            });

            // Olasılıkları 100'e normalize et
            const totalProb = oddsData.reduce((sum, t) => sum + t.probability, 0);
            if (totalProb > 0) {
                oddsData.forEach(t => t.probability = Math.round((t.probability / totalProb) * 100));
            }

            container.innerHTML = oddsData.map((team, i) => {
                const barColor = i === 0 ? '#ffd700' : (team.canWin ? '#c4ff0e' : '#555');
                const textColor = team.canWin ? '#fff' : '#666';

                return `
                    <div style="display: grid; grid-template-columns: 1fr 80px 1fr; gap: 15px; align-items: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-family: var(--font-head); font-size: 1.2rem; color: ${i < 3 ? ['#ffd700', '#c0c0c0', '#cd7f32'][i] : 'var(--text-muted)'};">${i + 1}.</span>
                            <img src="${getLogoUrl(team.name)}" alt="${team.name}" style="width: 28px; height: 28px; object-fit: contain;">
                            <span style="font-weight: 600; color: ${textColor};">${team.name}</span>
                        </div>
                        <div style="text-align: center;">
                            <span style="font-family: var(--font-head); font-size: 1.5rem; color: ${barColor};">${team.probability}%</span>
                        </div>
                        <div style="position: relative; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden;">
                            <div style="height: 100%; width: ${team.probability}%; background: ${barColor}; border-radius: 6px; transition: width 0.5s ease;"></div>
                        </div>
                    </div>
                `;
            }).join('') + `
                <p style="text-align: center; color: var(--text-muted); font-size: 0.8rem; margin-top: 15px;">
                    <i class="fas fa-info-circle"></i> Kalan ${remainingRounds} maça göre hesaplandı
                </p>
            `;
        }

        // Sadece Firebase'den veri y�kle
        let dataLoaded = false;

        function init() {
            listenAllData((data) => {
                dataLoaded = true;
                tribeData = data;
                renderStandings(data);
            });

            // 3 saniye fallback
            setTimeout(() => {
                if (!dataLoaded && typeof TribeData !== 'undefined') {
                    tribeData = TribeData;
                    renderStandings(TribeData);
                }
            }, 3000);
        }

        // Şampiyon animasyonu için yıldızlar
        function createStars() {
            const container = document.getElementById('championStars');
            const symbols = ['★', '✦', '✧', '⭐', '🏆'];
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('span');
                star.className = 'star';
                star.innerHTML = symbols[Math.floor(Math.random() * symbols.length)];
                star.style.left = Math.random() * 100 + '%';
                star.style.fontSize = (Math.random() * 20 + 10) + 'px';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                star.style.animationDelay = Math.random() * 3 + 's';
                container.appendChild(star);
            }
        }

        function closeChampionOverlay() {
            const overlay = document.getElementById('championOverlay');
            overlay.classList.add('hiding');
            setTimeout(() => overlay.remove(), 800);
        }

        // 5 saniye sonra otomatik kapat
        setTimeout(closeChampionOverlay, 5000);
        createStars();

        init();
    </script>

    <script src="../theme-switcher.js"></script>
</body>

</html>