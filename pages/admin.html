<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tribe League - Yönetim Paneli</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Outfit:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <style>
        /* --- CORE THEME (Dark/Neon) --- */
        :root {
            --bg: #0a0a0e;
            --panel: #141419;
            --primary: #c4ff0e;
            --primary-glow: rgba(196, 255, 14, 0.4);
            --secondary: #5742f5;
            --text: #ffffff;
            --border: rgba(255, 255, 255, 0.08);
            --font-head: 'Teko', sans-serif;
            --font-body: 'Outfit', sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: var(--font-body);
            overflow: auto;
        }

        /* --- LOGIN OVERLAY --- */
        #login-gate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-box {
            background: var(--panel);
            border: 1px solid var(--border);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            width: 350px;
            box-shadow: 0 0 50px rgba(196, 255, 14, 0.1);
        }

        .login-title {
            font-family: var(--font-head);
            font-size: 3rem;
            margin: 0 0 20px;
            line-height: 1;
        }

        .login-title span {
            color: var(--primary);
        }

        .login-input {
            width: 100%;
            background: #000;
            border: 1px solid var(--border);
            color: #fff;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-family: var(--font-body);
            outline: none;
            transition: 0.3s;
        }

        .login-input:focus {
            border-color: var(--primary);
        }

        .login-btn {
            width: 100%;
            background: var(--primary);
            color: #000;
            border: none;
            padding: 12px;
            font-weight: bold;
            font-family: var(--font-head);
            font-size: 1.2rem;
            cursor: pointer;
            border-radius: 8px;
            transition: 0.3s;
        }

        .login-btn:hover {
            box-shadow: 0 0 20px var(--primary-glow);
        }

        /* --- ADMIN DASHBOARD --- */
        #admin-dash {
            display: none;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER */
        .dash-header {
            height: 70px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            background: rgba(20, 20, 25, 0.8);
        }

        .dash-logo {
            font-size: 2rem;
            font-family: var(--font-head);
        }

        .dash-logo span {
            color: var(--primary);
        }

        /* LAYOUT */
        .dash-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .dash-sidebar {
            width: 250px;
            border-right: 1px solid var(--border);
            background: var(--panel);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-link {
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            color: #888;
            font-weight: 600;
            text-transform: uppercase;
            font-family: var(--font-head);
            font-size: 1.2rem;
            transition: 0.3s;
        }

        .nav-link:hover,
        .nav-link.active {
            background: rgba(196, 255, 14, 0.1);
            color: var(--primary);
        }

        .dash-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        /* VISUAL EDITOR STYLES */
        .editor-section {
            display: none;
            max-width: 1000px;
            margin: 0 auto;
        }

        .editor-section.active {
            display: block;
        }

        .editor-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .tool-title {
            font-family: var(--font-head);
            font-size: 3rem;
            color: #fff;
            margin: 0;
        }

        .tool-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: #222;
            color: #fff;
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .action-btn:hover {
            background: #333;
        }

        .btn-primary {
            background: var(--primary);
            color: #000;
            border: none;
        }

        .btn-primary:hover {
            opacity: 0.8;
            background: var(--primary);
        }

        /* PREVIEW AREA (The Visual Table) */
        .visual-preview {
            border: 2px dashed #333;
            border-radius: 12px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .visual-preview:hover {
            border-color: #555;
        }

        /* CONTENT EDITABLE HIGHLIGHT */
        [contenteditable]:focus {
            outline: 2px solid var(--primary);
            background: rgba(196, 255, 14, 0.1);
        }

        /* GENERATED CODE BOX */
        .code-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .code-box {
            background: #111;
            border: 1px solid var(--border);
            width: 800px;
            padding: 30px;
            border-radius: 12px;
        }

        .code-textarea {
            width: 100%;
            height: 300px;
            background: #000;
            color: #0f0;
            border: 1px solid #333;
            font-family: monospace;
            padding: 15px;
            margin-top: 15px;
        }


        .code-textarea {
            width: 100%;
            height: 300px;
            background: #000;
            color: #0f0;
            border: 1px solid #333;
            font-family: monospace;
            padding: 15px;
            margin-top: 15px;
        }

        /* --- THEME SPECIFIC MOCKS (Same as Website) --- */
        .team-logo-sm {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }

        /* Table */
        .modern-table {
            width: 100%;
            border-collapse: collapse;
        }

        .modern-table th {
            background: rgba(255, 255, 255, 0.05);
            color: var(--primary);
            font-family: var(--font-head);
            font-size: 1.4rem;
            padding: 15px;
            text-align: left;
        }

        .modern-table td {
            border-bottom: 1px solid var(--border);
            padding: 15px;
            vertical-align: middle;
        }

        /* Forms */
        .form-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            margin: 0 2px;
            text-align: center;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            color: #fff;
            cursor: pointer;
        }

        .form-G {
            background: #28a745;
        }

        .form-B {
            background: #ffc107;
            color: #000;
        }

        .form-M {
            background: #dc3545;
        }

        /* Fixtures */
        .week-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-arrow {
            cursor: pointer;
            font-size: 1.5rem;
            user-select: none;
        }

        .week-display {
            font-family: var(--font-head);
            font-size: 2rem;
            color: #fff;
        }

        .match-card {
            display: flex;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
        }

        .match-side {
            flex: 1;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .home {
            justify-content: flex-end;
            text-align: right;
            border-right: 1px solid var(--border);
        }

        .away {
            justify-content: flex-start;
            text-align: left;
        }

        .match-center {
            width: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
        }

        .score-display {
            font-size: 2rem;
            color: var(--primary);
            font-family: var(--font-head);
            font-weight: 700;
        }

        /* Edit Controls overlay */
        .row-control {
            color: #dc3545;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2rem;
        }
    </style>
</head>

<body>

    <!-- 1. LOGIN GATE -->
    <div id="login-gate">
        <div class="login-box">
            <h1 class="login-title">TRIBE <span>ADMIN</span></h1>
            <input type="text" id="username" class="login-input" placeholder="Kullanıcı Adı">
            <input type="password" id="password" class="login-input" placeholder="Şifre">
            <button class="login-btn" onclick="tryLogin()">GİRİŞ YAP</button>
            <p id="login-error" style="color:#ff0055; margin-top:15px; display:none;">Hatalı Kullanıcı Adı veya Şifre!
            </p>
        </div>
    </div>

    <!-- 2. ADMIN DASHBOARD -->
    <div id="admin-dash" style="display:none;"> <!-- Hidden by default -->
        <header class="dash-header">
            <div class="dash-logo">TRIBE <span>LEAGUE</span></div>
            <button class="action-btn" onclick="logout()">ÇIkış</button>
        </header>

        <div class="dash-body">
            <aside class="dash-sidebar">
                <div class="nav-link active" onclick="switchTab('standings')">PUAN DURUMU</div>
                <div class="nav-link" onclick="switchTab('fixtures')">FİKSTÜR</div>
                <div class="nav-link" onclick="switchTab('scorers')">GOL KRALLIĞI</div>
                <div class="nav-link" onclick="switchTab('assists')">ASİST KRALLIĞI</div>
            </aside>

            <main class="dash-content">

                <!-- === MODULE: STANDINGS === -->
                <section id="mod-standings" class="editor-section active">
                    <div class="editor-toolbar">
                        <h2 class="tool-title">PUAN DURUMU</h2>
                        <div class="tool-actions">
                            <button class="action-btn" onclick="addRow('standings-body')">+ Satır Ekle</button>
                            <button class="action-btn btn-primary" onclick="exportHTML('standings')">HTML Kodu
                                Al</button>
                        </div>
                    </div>
                    <div class="visual-preview" id="preview-standings">
                        <div class="special-container">
                            <!-- HEADER BANNER -->
                            <div class="header-banner"
                                style="position:relative; overflow:hidden; text-align:center; background: linear-gradient(135deg, #222 0%, #111 100%); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 30px; margin-bottom: 30px;">
                                <h1
                                    style="font-family: 'Teko', sans-serif; font-size: 4rem; color: #c4ff0e; margin: 0; line-height: 1;">
                                    PUAN DURUMU</h1>
                            </div>
                            <table class="modern-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>TAKIM</th>
                                        <th>O</th>
                                        <th>G</th>
                                        <th>B</th>
                                        <th>M</th>
                                        <th>AV</th>
                                        <th>P</th>
                                        <th>FORM</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="standings-body">
                                    <!-- Rows generated by JS or Default -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- === MODULE: FIXTURES (MULTI WEEK) === -->
                <section id="mod-fixtures" class="editor-section">
                    <div class="editor-toolbar">
                        <h2 class="tool-title">FİKSTÜR</h2>
                        <div class="tool-actions">
                            <button class="action-btn" onclick="addMatch()">+ Maç Ekle</button>
                            <button class="action-btn btn-primary" onclick="exportHTML('fixtures')">HTML Kodu
                                Al</button>
                        </div>
                    </div>

                    <!-- Week Nav Control in Admin -->
                    <div class="week-nav"
                        style="background:#111; padding:15px; border-radius:12px; margin-bottom:20px;">
                        <div class="week-arrow" onclick="changeAdminWeek(-1)">❮</div>
                        <div class="week-display">Hafta <span id="current-week-num">1</span></div>
                        <div class="week-arrow" onclick="changeAdminWeek(1)">❯</div>
                        <button class="action-btn" style="margin-left:20px; font-size:0.8rem;" onclick="addNewWeek()">+
                            Yeni Hafta Oluştur</button>
                    </div>

                    <div class="visual-preview" id="preview-fixtures">
                        <div class="special-container">
                            <div class="header-banner"
                                style="position:relative; overflow:hidden; text-align:center; background: linear-gradient(135deg, #222 0%, #111 100%); border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 30px; margin-bottom: 30px;">
                                <h1
                                    style="font-family: 'Teko', sans-serif; font-size: 4rem; color: #c4ff0e; margin: 0; line-height: 1;">
                                    FİKSTÜR</h1>
                            </div>
                            <!-- WEEKS CONTAINER -->
                            <div id="weeks-container">
                                <!-- Week 1 -->
                                <div class="fixture-week" id="week-1" data-week="1">
                                    <div class="week-title"
                                        style="text-align:center; font-family:'Teko'; font-size:2rem; color:#fff; margin-bottom:20px;">
                                        1. HAFTA</div>
                                    <div class="matches-list" id="matches-week-1">
                                        <!-- Matches go here -->
                                        <div class="match-card">
                                            <div class="match-side home"><span class="team-name"
                                                    contenteditable="true">Ev Sahibi</span></div>
                                            <div class="match-center">
                                                <div class="score-display" contenteditable="true">0 - 0</div>
                                            </div>
                                            <div class="match-side away"><span class="team-name"
                                                    contenteditable="true">Deplasman</span></div>
                                            <i class="fas fa-trash row-control"
                                                onclick="this.parentElement.remove()"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- JS for Fixture Nav (Injected on Export) -->
                        </div>
                    </div>
                </section>

                <!-- === MODULE: SCORERS === -->
                <section id="mod-scorers" class="editor-section">
                    <div class="editor-toolbar">
                        <h2 class="tool-title">GOL KRALLIĞI</h2>
                        <div class="tool-actions"><button class="action-btn" onclick="addRow('scorers-body')">+
                                Ekle</button><button class="action-btn btn-primary" onclick="exportHTML('scorers')">HTML
                                Kodu Al</button></div>
                    </div>
                    <div class="visual-preview" id="preview-scorers">
                        <div class="special-container">
                            <div class="header-banner"
                                style="text-align:center; background: linear-gradient(135deg, #222 0%, #111 100%); border: 1px solid #333; border-radius: 12px; padding: 30px; margin-bottom: 30px;">
                                <h1 style="font-family: 'Teko'; font-size: 4rem; color: #c4ff0e; margin: 0;">GOL
                                    KRALLIĞI</h1>
                            </div>
                            <table class="modern-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>FUTBOLCU</th>
                                        <th>TAKIM</th>
                                        <th>GOL</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="scorers-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- === MODULE: ASSISTS === -->
                <section id="mod-assists" class="editor-section">
                    <div class="editor-toolbar">
                        <h2 class="tool-title">ASİST KRALLIĞI</h2>
                        <div class="tool-actions"><button class="action-btn" onclick="addRow('assists-body')">+
                                Ekle</button><button class="action-btn btn-primary" onclick="exportHTML('assists')">HTML
                                Kodu Al</button></div>
                    </div>
                    <div class="visual-preview" id="preview-assists">
                        <div class="special-container">
                            <div class="header-banner"
                                style="text-align:center; background: linear-gradient(135deg, #222 0%, #111 100%); border: 1px solid #333; border-radius: 12px; padding: 30px; margin-bottom: 30px;">
                                <h1 style="font-family: 'Teko'; font-size: 4rem; color: #c4ff0e; margin: 0;">ASİST
                                    KRALLIĞI</h1>
                            </div>
                            <table class="modern-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>FUTBOLCU</th>
                                        <th>TAKIM</th>
                                        <th>ASİST</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="assists-body"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- EXPORT MODAL -->
    <div id="export-modal" class="code-modal">
        <div class="code-box">
            <h2 style="color:var(--primary); margin:0;">HTML KODU HAZIR</h2>
            <p>Aşağıdaki kodu kopyalayıp Blogger'a yapıştırın (CTRL+A, CTRL+C)</p>
            <textarea id="final-code" class="code-textarea"></textarea>
            <button class="action-btn" style="margin-top:15px;"
                onclick="document.getElementById('export-modal').style.display='none'">Kapat</button>
            <button class="action-btn btn-primary" onclick="copyCode()">Kopyala</button>
        </div>
    </div>

    <script>
        // --- 0. DATA & CONFIG ---
        const TEAM_LOGOS = {
            "Galatasaray": "https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Galatasaray_Sports_Club_Logo.svg/1200px-Galatasaray_Sports_Club_Logo.svg.png",
            "Fenerbahçe": "https://upload.wikimedia.org/wikipedia/tr/thumb/8/86/Fenerbah%C3%A7e_SK.png/250px-Fenerbah%C3%A7e_SK.png",
            "Beşiktaş": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/BesiktasJK-Logo.svg/250px-BesiktasJK-Logo.svg.png",
            "Trabzonspor": "https://upload.wikimedia.org/wikipedia/tr/a/ab/TrabzonsporAmblemi.png",
            "Başakşehir": "https://upload.wikimedia.org/wikipedia/tr/thumb/c/cd/%C4%B0stanbul_Ba%C5%9Fak%C5%9Fehir_FK.png/250px-%C4%B0stanbul_Ba%C5%9Fak%C5%9Fehir_FK.png",
            "Alanyaspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/2/29/Alanyaspor_logo.png/250px-Alanyaspor_logo.png",
            "Eyüpspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/1/10/Ey%C3%BCpspor_logo.png/250px-Ey%C3%BCpspor_logo.png",
            "Adanademirspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/5/5f/Adanademirspor.png/250px-Adanademirspor.png",
            "Kayserispor": "https://upload.wikimedia.org/wikipedia/tr/thumb/c/c2/Kayserispor_logosu.png/250px-Kayserispor_logosu.png",
            "Rizespor": "https://upload.wikimedia.org/wikipedia/tr/thumb/f/f6/%C3%87aykur_Rizespor_Logo.png/250px-%C3%87aykur_Rizespor_Logo.png",
            "Gaziantep": "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/GFK-Official-Logo.png/250px-GFK-Official-Logo.png",
            "Göztepe": "https://upload.wikimedia.org/wikipedia/tr/thumb/f/fe/G%C3%B6ztepe.png/250px-G%C3%B6ztepe.png",
            "Hatayspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/0/08/Hatayspor.png/250px-Hatayspor.png",
            "Kasımpaşa": "https://upload.wikimedia.org/wikipedia/tr/thumb/6/68/Kasimpasa_2012.png/250px-Kasimpasa_2012.png",
            "Samsunspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/d/d2/Samsunspor_logo.png/250px-Samsunspor_logo.png",
            "Sivasspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/8/80/Sivasspor.png/250px-Sivasspor.png",
            "Antalyaspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/b/b9/Antalyaspor_logo.png/250px-Antalyaspor_logo.png",
            "Konyaspor": "https://upload.wikimedia.org/wikipedia/tr/thumb/4/41/Konyaspor_1922.png/250px-Konyaspor_1922.png"
        };

        function getLogoUrl(name) {
            if (!name) return "https://via.placeholder.com/30?text=?";
            const exact = TEAM_LOGOS[name.trim()];
            if (exact) return exact;
            const lower = name.trim().toLowerCase();
            const foundKey = Object.keys(TEAM_LOGOS).find(k => k.toLowerCase() === lower);
            if (foundKey) return TEAM_LOGOS[foundKey];
            return "https://via.placeholder.com/30?text=?";
        }

        // --- 1. LOGIN LOGIC (SHA-256 SECURED) ---
        // User: "tribeleague"
        const _uHash = "b6f360c00899c231d3580106b4512d74253cbd2265d855edc8a2581d671032f2";
        // Pass: "Tribe2025!"
        const _pHash = "69dd2706f9ebf21c1ae2654b3d5cd3b0e36afeb1cfb0ac71c01689226963456e";

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        async function tryLogin() {
            // Trim inputs to remove accidental spaces and force lowercase user
            const uInput = document.getElementById('username').value.trim().toLowerCase();
            const pInput = document.getElementById('password').value.trim();

            try {
                const uH = await sha256(uInput);
                const pH = await sha256(pInput);

                // DEBUG LOGS
                console.log("Input User:", uInput, "Hash:", uH);
                console.log("Expected User Hash:", _uHash);
                console.log("Input Pass:", pInput, "Hash:", pH);
                console.log("Expected Pass Hash:", _pHash);

                if (uH === _uHash && pH === _pHash) {
                    document.getElementById('login-gate').style.display = 'none';
                    document.getElementById('admin-dash').style.display = 'flex';
                    loadAllData();
                } else {
                    throw new Error("Mismatch");
                }
            } catch (e) {
                console.error(e);
                document.getElementById('login-error').style.display = 'block';
                document.getElementById('login-error').innerText = "Hatalı Giriş! (Boşluklara ve Büyük/Küçük harfe dikkat)";
            }
        }
        function logout() { location.reload(); }

        // --- 2. TABS ---
        function switchTab(id) {
            document.querySelectorAll('.editor-section').forEach(el => el.classList.remove('active'));
            document.getElementById('mod-' + id).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- 3. ROW MANAGEMENT ---
        function addRow(tbodyId) {
            const tbody = document.getElementById(tbodyId);
            const newRow = document.createElement('tr');

            if (tbodyId.includes('standings')) {
                newRow.innerHTML = `
                <td class="rank-cell" contenteditable="true">#</td>
                <td><div class="team-flex"><img src="https://via.placeholder.com/30" class="team-logo-sm"><span class="team-name" contenteditable="true">Takım Adı</span></div></td>
                <td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td><td contenteditable="true">0</td>
                <td contenteditable="true">0</td><td><span class="points-box" contenteditable="true">0</span></td>
                <td><div style="display:flex; gap:2px;">
                    <span class="form-box form-G" contenteditable="true">G</span>
                    <span class="form-box form-B" contenteditable="true">B</span>
                </div></td>
                <td><i class="fas fa-trash row-control" onclick="this.closest('tr').remove()"></i></td>
            `;
            } else {
                newRow.innerHTML = `
                <td class="rank-cell" contenteditable="true">#</td>
                <td contenteditable="true" style="font-weight:600">Oyuncu Adı</td>
                <td><div class="team-flex"><img src="https://via.placeholder.com/30" class="team-logo-sm"><span class="team-name" contenteditable="true">Takım</span></div></td>
                 <td><span class="points-box" contenteditable="true">0</span></td>
                 <td><i class="fas fa-trash row-control" onclick="this.closest('tr').remove()"></i></td>
            `;
            }
            tbody.appendChild(newRow);
            saveAllData();
        }

        // --- 4. FIXTURE WEEKS MANAGEMENT ---
        let currentAdminWeek = 1;
        function changeAdminWeek(dir) {
            const totalWeeks = document.querySelectorAll('.fixture-week').length;
            let next = currentAdminWeek + dir;
            if (next < 1) next = 1;
            if (next > totalWeeks) next = totalWeeks;
            currentAdminWeek = next;
            updateWeekView();
        }
        function updateWeekView() {
            document.querySelectorAll('.fixture-week').forEach(el => el.style.display = 'none');
            const target = document.getElementById('week-' + currentAdminWeek);
            if (target) target.style.display = 'block';
            document.getElementById('current-week-num').innerText = currentAdminWeek;
        }
        function addNewWeek() {
            const container = document.getElementById('weeks-container');
            const num = document.querySelectorAll('.fixture-week').length + 1;
            const div = document.createElement('div');
            div.className = 'fixture-week';
            div.id = 'week-' + num;
            div.dataset.week = num;
            div.style.display = 'none';
            div.innerHTML = `
            <div class="week-title" style="text-align:center; font-family:'Teko'; font-size:2rem; color:#fff; margin-bottom:20px;">${num}. HAFTA</div>
            <div class="matches-list" id="matches-week-${num}"></div>
        `;
            container.appendChild(div);
            changeAdminWeek(1); // Go to new week
            addMatch(); // Add one initial match
            saveAllData();
        }
        function addMatch() {
            const list = document.getElementById('matches-week-' + currentAdminWeek);
            const div = document.createElement('div');
            div.className = 'match-card';
            div.innerHTML = `
            <div class="match-side home">
                <span class="team-name" contenteditable="true">Ev Sahibi</span>
                <img src="https://via.placeholder.com/30?text=?" class="team-logo-sm">
            </div>
            <div class="match-center"><div class="score-display" contenteditable="true">- - -</div></div>
            <div class="match-side away">
                <img src="https://via.placeholder.com/30?text=?" class="team-logo-sm">
                <span class="team-name" contenteditable="true">Deplasman</span>
            </div>
            <i class="fas fa-trash row-control" style="padding:10px;" onclick="this.closest('.match-card').remove()"></i>
        `;
            list.appendChild(div);
            // Trigger auto-logo update just in case default text matches something (unlikely)
            saveAllData();
        }

        // --- 5. EXPORT LOGIC (FULL HTML) ---
        function exportHTML(type) {
            const sourceId = 'preview-' + type;
            const source = document.getElementById(sourceId).cloneNode(true);

            // CLEANUP
            source.querySelectorAll('.row-control').forEach(el => el.remove());
            source.querySelectorAll('[contenteditable]').forEach(el => el.removeAttribute('contenteditable'));

            // CSS CONTENT
            const styles = `
    <style>
        :root {
            --bg-body: #0a0a0e; 
            --bg-card: #141419;
            --primary: #c4ff0e;
            --border: rgba(255,255,255,0.08);
            --radius: 16px;
            --font-head: 'Teko', sans-serif;
            --font-body: 'Outfit', sans-serif;
        }
        body { background: var(--bg-body); color: #fff; font-family: var(--font-body); padding: 0; margin: 0; }
        .special-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 30px; max-width: 1000px; margin: 30px auto; }
        .header-banner { background: #111; border: 1px solid var(--border); border-radius: 12px; padding: 30px; margin-bottom: 30px; text-align:center; }
        .header-banner h1 { font-family: var(--font-head); font-size: 3.5rem; color: var(--primary); margin: 0; }
        .modern-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .modern-table th { text-align: left; padding: 15px; background: rgba(255,255,255,0.05); color: var(--primary); font-family: var(--font-head); font-size: 1.4rem; }
        .modern-table td { padding: 15px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .rank-cell { font-weight: bold; color: var(--primary); font-size: 1.2rem; }
        .team-flex { display: flex; align-items: center; gap: 10px; }
        .team-logo-sm { width: 30px; height: 30px; object-fit: contain; }
        .points-box { background: var(--primary); color: #000; padding: 5px 10px; border-radius: 6px; font-weight: 800; font-family: var(--font-head); }
        .form-box { display:inline-block; width:20px; height:20px; line-height:20px; margin:0 2px; text-align:center; border-radius:4px; font-size:10px; font-weight:bold; color:#fff; }
        .form-G { background: #28a745; } .form-B { background: #ffc107; color:#000; } .form-M { background: #dc3545; }
        
        /* Fixture Specific */
        .week-navigation { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 30px; }
        .week-arrow { cursor: pointer; font-size: 2rem; user-select: none; padding: 10px; }
        .week-display { font-family: var(--font-head); font-size: 2rem; color: #fff; }
        .match-card { display: flex; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 15px; }
        .match-side { flex: 1; padding: 20px; display: flex; align-items: center; gap: 15px; }
        .match-home { justify-content: flex-end; text-align: right; border-right: 1px solid var(--border); }
        .match-away { justify-content: flex-start; text-align: left; }
        .match-center { width: 100px; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.3); }
        .score-display { font-size: 2rem; color: var(--primary); font-family: var(--font-head); font-weight: 700; }
    </style>
        `;

            // BUILD HTML DOCUMENT
            let contentBody = '';

            if (type === 'fixtures') {
                // JS Injection for Fixtures
                const script = `
<script>
    let currentWeek = 1;
    function showWeek(dir) {
        const weeks = document.querySelectorAll('.fixture-week');
        let next = currentWeek + dir;
        if(next < 1) next = weeks.length; 
        if(next > weeks.length) next = 1; 
        currentWeek = next;
        
        weeks.forEach(w => w.style.display='none');
        document.getElementById('week-'+currentWeek).style.display='block';
    }
    // Init
    document.addEventListener('DOMContentLoaded', () => {
         document.querySelectorAll('.fixture-week').forEach(w => w.style.display='none');
         const start = document.getElementById('week-1');
         if(start) start.style.display='block';
    });
<\/script>`;

                const navHTML = `
                <div class="week-navigation">
                    <div class="week-arrow" onclick="showWeek(-1)">❮</div>
                    <div class="week-display">HAFTALAR</div>
                    <div class="week-arrow" onclick="showWeek(1)">❯</div>
                </div>
            `;

                contentBody = source.querySelector('.header-banner').outerHTML +
                    navHTML +
                    source.querySelector('#weeks-container').outerHTML +
                    script;
            } else {
                contentBody = source.innerHTML;
            }

            const fullHTML = `<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${type.toUpperCase()}</title>
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;600&family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    ${styles}
</head>
<body>
    <div class="special-container">
        ${contentBody}
    </div>
</body>
</html>`;

            document.getElementById('final-code').value = fullHTML;
            document.getElementById('export-modal').style.display = 'flex';
        }

        function copyCode() {
            document.getElementById('final-code').select();
            document.execCommand('copy');
            alert("Tam HTML Kodu Kopyalandı!");
        }

        // --- 6. AUTO SAVE ---
        function saveAllData() {
            const data = {
                standings: document.getElementById('standings-body').innerHTML,
                fixtures: document.getElementById('weeks-container').innerHTML,
                scorers: document.getElementById('scorers-body').innerHTML,
                assists: document.getElementById('assists-body').innerHTML
            };
            localStorage.setItem('tribe_visual_data', JSON.stringify(data));
        }

        function loadAllData() {
            if (!localStorage.getItem('tribe_visual_data')) return;
            const data = JSON.parse(localStorage.getItem('tribe_visual_data'));

            if (data.standings) document.getElementById('standings-body').innerHTML = data.standings;
            if (data.fixtures) document.getElementById('weeks-container').innerHTML = data.fixtures;
            if (data.scorers) document.getElementById('scorers-body').innerHTML = data.scorers;
            if (data.assists) document.getElementById('assists-body').innerHTML = data.assists;

            changeAdminWeek(0);
        }

        // --- 6. GLOBAL AUTOMATION & AUTO SAVE ---
        document.addEventListener('input', (e) => {
            const target = e.target;

            // 1. AUTO LOGO UPDATE
            if (target.classList.contains('team-name')) {
                const name = target.innerText;
                const logoUrl = getLogoUrl(name);
                // Find sibling image? 
                // Structure: [img] [span.team-name]  (Both Fixtures and Standings follow this now)
                const parent = target.parentElement;
                const img = parent.querySelector('img.team-logo-sm');
                if (img) {
                    img.src = logoUrl;
                }
            }

            // 2. FORM GUIDE COLORING
            if (target.classList.contains('form-box')) {
                const val = target.innerText.trim().toUpperCase();
                target.classList.remove('form-G', 'form-B', 'form-M');
                if (val === 'G') target.classList.add('form-G');
                else if (val === 'B') target.classList.add('form-B');
                else if (['L', 'M'].includes(val)) target.classList.add('form-M');
            }

            // 3. AUTO SAVE
            if (document.getElementById('admin-dash').style.display !== 'none') {
                saveAllData();
            }
        });

    </script>

    <script src="../theme-switcher.js"></script>
</body>

</html>